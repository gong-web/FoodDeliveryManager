{% extends "base.html" %}

{% block title %}åˆ›å»ºæ–°è®¢å•{% endblock %}

{% block content %}
<div class="order-container">
  <h2 class="section-title">ğŸ” æ–°å»ºè®¢å•</h2>
  
  {% if error %}
  <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <form method="POST" class="order-form">
    <!-- å®¢æˆ·ä¿¡æ¯ -->
    <div class="form-card">
      <h3>ğŸ‘¤ å®¢æˆ·ä¿¡æ¯</h3>
      <div class="form-group">
        <select class="form-control" name="person_id" required>
          <option value="">-- é€‰æ‹©å®¢æˆ· --</option>
          {% for person in persons %}
          <option value="{{ person.PersonId }}">{{ person.Name }} ({{ person.ContactNumber }})</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- å¸æœºä¿¡æ¯ -->
    <div class="form-card">
      <h3>ğŸš— å¸æœºä¿¡æ¯</h3>
      <div class="form-group">
        <select class="form-control" name="driver_id" required>
          <option value="" disabled selected>-- é€‰æ‹©å¸æœº --</option>
          {% for driver in drivers %}
          <option value="{{ driver.DriverId }}">{{ driver.DriverName }} â˜…{{ driver.Rating|round(1) }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    
    <!-- é¤å…é€‰æ‹© -->
    <div class="form-card">
      <h3>ğŸ½ï¸ é¤å…é€‰æ‹©</h3>
      <div class="form-group">
        <select class="form-control" name="restaurant_id" required>
          <option value="">-- é€‰æ‹©é¤å… --</option>
          {% for res in restaurants %}
          <option value="{{ res.RestaurantId }}">{{ res.Name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- é…é€ä¿¡æ¯ -->
    <div class="form-card">
      <h3>â° é…é€ä¿¡æ¯</h3>
      <div class="row g-3">
        <div class="col-md-2">
          <label>é…é€æ—¶é—´</label>
          <input type="datetime-local" class="form-control"
                 name="delivery_time"
                 value="{{ now.strftime('%Y-%m-%dT%H:%M') }}"
                 max="{{ now.strftime('%Y-%m-%dT%H:%M') }}">
        </div>
        <div class="col-md-2">
          <label>é…é€è´¹ç”¨</label>
          <div class="input-group">
            <span class="input-group-text">Â¥</span>
            <input type="number" class="form-control" 
                   name="delivery_charges" value="8" readonly>
          </div>
        </div>
      </div>
    </div>

    <!-- å•†å“é€‰æ‹© -->
<!-- å•†å“é€‰æ‹©éƒ¨åˆ† -->
  <div class="form-card">
    <h3>ğŸŸ é€‰æ‹©å•†å“</h3>
    <div id="items-container" class="row g-3">
      {% for item in items %}
      <div class="col-md-2">
        <div class="input-group mb-2">
          <span class="input-group-text">
            {{ item.Name }}<br>
            <small style="color:#888;">ï¼ˆ{{ item.RestaurantName }}ï¼‰</small>
          </span>
          <input type="number" class="form-control" name="item_{{ item.ItemRestaurantMappingId }}" value="0" min="0" placeholder="è¯·è¾“å…¥æ•°é‡">
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
      <button type="button" class="btn btn-secondary mt-3" onclick="addItemField()">
        â• æ·»åŠ å•†å“
      </button>
    </div>

    <!-- æäº¤åŒºåŸŸ -->
    <div class="form-card total-card">
      <div class="row g-3">
        <div class="col-md-2">
          <label>è®¢å•æ€»é¢</label>
        <div class="input-group">
            <span class="input-group-text">Â¥</span>
            <input type="number" class="form-control" 
                name="total_price"
                placeholder="è¯·è¾“å…¥è®¢å•æ€»é¢">
        </div>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            ğŸš€ æäº¤è®¢å•
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<style>
.order-container {
  max-width: 1800px;
  margin: 20px auto;
  padding: 20px;
}
.form-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border: 1px solid #eee;
}
.form-card h3 {
  color: #2c3e50;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #3498db;
}
.total-card {
  background: #f8f9fa;
  border-color: #3498db;
}
.btn-primary {
  background: #3498db;
  border-radius: 8px;
  padding: 12px 24px;
}
.input-group-text {
  background: #f8f9fa;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// æ·»åŠ å•†å“å­—æ®µ
let itemCount = 1;
function addItemField() {
  const container = document.getElementById('items-container');
  const newItem = document.createElement('div');
  newItem.className = 'col-md-2';
  newItem.innerHTML = `
    <div class="input-group">
      <select class="form-select" name="items" required>
        <option value="">-- é€‰æ‹©å•†å“ --</option>
        {% for item in items %}
        <option value="{{ item.ItemId }}">{{ item.Name }}</option>
        {% endfor %}
      </select>
    </div>`;
  container.appendChild(newItem);
  itemCount++;
}
</script>
{% endblock %}